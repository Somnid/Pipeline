var TextTransform = (function(){

	function doTransform(transformName, text, functionString){
		var func = new Function("item", "index", functionString);
		var array = text.split("\n");
		var result = transforms[transformName](array, func);
		return result;
	}

	var transforms = {
		select : function(array, selectorFunction){
			var selectionArray = [];
			for(var i = 0; i < array.length; i++){
				selectionArray.push(selectorFunction(array[i], i));
			}
			return selectionArray;
		},
		where : function(array, whereFunction){
			var resultArray = [];
			for(var i = 0; i < array.length; i++){
				if(whereFunction(array[i])){
					resultArray.push(array[i]);
				}
			}
			return resultArray;
		},
		print : function(array, printFunction){
			var result = "";
			for(var i = 0; i < array.length; i++){
				result += printFunction(array[i]) + "\n";
			}
			return result;
		},
		count : function(array, countFunction){
			var count = 0;
			for(var i = 0; i < array.length; i++){
				if(countFunction(array[i])){
					count++;
				}
			}
			return count;
		},
		hash : function(array, hashFunction){
			var result = {};
			for(var i = 0; i < array.length; i++){
				var keyVal = hashFunction(array[i]);
				result[keyVal.key] = keyVal.value;
			}
			return result;
		},
		distinct : function(array, distinctFunction){
			var result = [];
			for(var i = 0; i < array.length; i++){
				var value = distinctFunction(array[i]);
				if(result.indexOf(value) == -1){
					result.push(value);
				}
			}
			return result;
		}
	};

	return {
		doTransform : doTransform
	};

})(); 